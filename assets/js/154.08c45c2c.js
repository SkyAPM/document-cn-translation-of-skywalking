(window.webpackJsonp=window.webpackJsonp||[]).push([[154],{430:function(t,s,e){"use strict";e.r(s);var a=e(0),n=Object(a.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),e("p",[t._v("报警规则主要有以下几点：")]),t._v(" "),t._m(4),t._v(" "),t._m(5),t._m(6),t._v(" "),t._m(7),t._v(" "),t._m(8),t._v(" "),e("p",[t._v("这些度量名称定义在 "),e("router-link",{attrs:{to:"./../../guides/backend-oal-scripts.html"}},[t._v("OAL 脚本")]),t._v("中, 现在，来自"),e("strong",[t._v("Service")]),t._v(", "),e("strong",[t._v("Service Instance")]),t._v(", "),e("strong",[t._v("Endpoint")]),t._v("的度量可以用于告警，我们会在后期版本中进行扩展。")],1),t._v(" "),e("p",[t._v("如果你希望有其它的告警场景，请提交issue或pr。")]),t._v(" "),t._m(9),t._v(" "),t._m(10),t._v(" "),t._m(11),t._v(" "),e("p",[t._v("以下是一个样例")]),t._v(" "),t._m(12)])}),[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"告警"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#告警"}},[this._v("#")]),this._v(" 告警")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("告警的核心由一组规则驱动，这些规则定义在"),s("code",[this._v("config/ Alarm -settings.yml")]),this._v("文件中。\n告警规则的定义分为两部分。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",[s("li",[this._v("告警规则。它们定义了应该如何触发度量警报，应该考虑什么条件。")]),this._v(" "),s("li",[this._v("[网络钩子](#Webhook}。当警告触发时，哪些服务终端需要被告知。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"规则"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#规则"}},[this._v("#")]),this._v(" 规则")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ul",[e("li",[e("strong",[t._v("Rule name")]),t._v("。在告警信息中显示的唯一名称。必须以"),e("code",[t._v("_rule")]),t._v("结尾。")]),t._v(" "),e("li",[e("strong",[t._v("Metrics name")]),t._v("。 也是oal脚本中的度量名。只支持long,double和int类型。详情见\n"),e("a",{attrs:{href:"#%E6%89%80%E6%9C%89%E5%8F%AF%E8%83%BD%E7%9A%84%E5%BA%A6%E9%87%8F%E5%90%8D%E7%A7%B0%E5%88%97%E8%A1%A8"}},[t._v("所有可能的度量名称列表")]),t._v(".")]),t._v(" "),e("li",[e("strong",[t._v("Include names")]),t._v("。其下的实体名称都在此规则中。比如服务名，终端名。")]),t._v(" "),e("li",[e("strong",[t._v("Threshold")]),t._v("。阈值。")]),t._v(" "),e("li",[e("strong",[t._v("OP")]),t._v("。 操作符, 支持 "),e("code",[t._v(">")]),t._v(", "),e("code",[t._v("<")]),t._v(", "),e("code",[t._v("=")]),t._v("。欢迎贡献所有的操作符。")]),t._v(" "),e("li",[e("strong",[t._v("Period")]),t._v(".。多久告警规则需要被核实一下。这是一个时间窗口，与后端部署环境时间相匹配。")]),t._v(" "),e("li",[e("strong",[t._v("Count")]),t._v("。 在一个Period窗口中，如果"),e("strong",[t._v("value")]),t._v("s超过Threshold值（按op），达到Count值，需要发送警报。")]),t._v(" "),e("li",[e("strong",[t._v("Silence period")]),t._v("。在时间N中触发报警后，在"),e("strong",[t._v("TN -> TN + period")]),t._v("这个阶段不告警。 默认情况下，它和"),e("strong",[t._v("Period")]),t._v("一样，这意味着相同的告警（在同一个Metrics name拥有相同的Id）在同一个Period内只会触发一次。")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rules")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Rule unique name, must be ended with `_rule`.")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("endpoint_percent_rule")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Metrics value need to be long, double or int")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metrics-name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" endpoint_percent\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("threshold")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("75")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("op")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The length of time to evaluate the metrics")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("period")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# How many times after the metrics match the condition, will trigger alarm")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("count")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# How many times of checks, the alarm keeps silence after alarm triggered, default as same as period.")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("silence-period")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n    \n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("service_percent_rule")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metrics-name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" service_percent\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# [Optional] Default, match all services in this metrics")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("include-names")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" service_a\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" service_b\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("threshold")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("85")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("op")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("period")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("count")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"默认告警规则"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#默认告警规则"}},[this._v("#")]),this._v(" 默认告警规则")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("为了方便，我们在发行版中提供了默认的"),s("code",[this._v("alarm setting.yml")]),this._v("文件，包括以下规则\n1.过去3分钟内服务平均响应时间超过1秒。\n1.服务成功率在过去2分钟内低于80%。\n1.服务90%响应时间在过去3分钟内低于1000毫秒.\n1.服务实例在过去2分钟内的平均响应时间超过1秒。\n1.端点平均响应时间过去2分钟超过1秒。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"所有可能的度量名称列表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#所有可能的度量名称列表"}},[this._v("#")]),this._v(" 所有可能的度量名称列表")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"webhook"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#webhook"}},[this._v("#")]),this._v(" Webhook")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("p",[t._v("SkyWalking 的告警 Webhook 要求对等方是一个 Web 容器. 告警的消息会通过 HTTP 请求进行发送, 请求方法为 "),e("code",[t._v("POST")]),t._v(", "),e("code",[t._v("Content-Type")]),t._v(" 为 "),e("code",[t._v("application/json")]),t._v(",\nJSON 格式基于 "),e("code",[t._v("List<org.apache.skywalking.oap.server.core.alarm.AlarmMessage")]),t._v(", 包含以下信息.")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ul",[e("li",[e("strong",[t._v("scopeId")]),t._v(". 所有可用的 Scope 请查阅 "),e("code",[t._v("org.apache.skywalking.oap.server.core.source.DefaultScopeDefine")]),t._v(".")]),t._v(" "),e("li",[e("strong",[t._v("name")]),t._v(". 目标 Scope 的实体名称.")]),t._v(" "),e("li",[e("strong",[t._v("id0")]),t._v(". Scope 实体的 ID.")]),t._v(" "),e("li",[e("strong",[t._v("id1")]),t._v(". 未使用.")]),t._v(" "),e("li",[e("strong",[t._v("alarmMessage")]),t._v(". 报警消息内容.")]),t._v(" "),e("li",[e("strong",[t._v("startTime")]),t._v(". 告警时间, 位于当前时间与 UTC 1920/1/1 之间.")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-json extra-class"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"scopeId"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n        "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"name"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"serviceA"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n\t"),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"id0"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  \n\t"),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"id1"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  \n\t"),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"alarmMessage"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"alarmMessage xxxx"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"startTime"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1560524171000")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"scopeId"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"name"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"serviceB"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"id0"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"id1"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"alarmMessage"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"alarmMessage yyy"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"startTime"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1560524171000")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])])}],!1,null,null,null);s.default=n.exports}}]);