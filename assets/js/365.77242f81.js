(window.webpackJsonp=window.webpackJsonp||[]).push([[365],{182:function(t,s,e){"use strict";e.r(s);var a=e(0),n=Object(a.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"content"},[t._m(0),t._v(" "),e("p",[t._v("为了让 Envoy 发送度量指标到 SkyWalking，我们需要给予 Envoy 一些包含 "),e("code",[t._v("stats_sinks")]),t._v(" 的配置，其中包括 "),e("code",[t._v("envoy.metrics_service")]),t._v("。\n"),e("code",[t._v("envoy.metrics_service")]),t._v(" 此配置应该作为 "),e("a",{attrs:{href:"https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/core/grpc_service.proto#envoy-api-msg-core-grpcservice",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("config.grpc_service")]),e("OutboundLink")],1),t._v(" 的一个配置项进行配置。")]),t._v(" "),e("p",[t._v("以下配置展示了其中比较有用的某些配置项：")]),t._v(" "),t._m(1),t._m(2),t._v(" "),e("p",[t._v("需要注意的是 Envoy 还可以进行通过 "),e("a",{attrs:{href:"https://github.com/envoyproxy/data-plane-api/blob/master/XDS_PROTOCOL.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("xDS Protocol"),e("OutboundLink")],1),t._v(" 进行动态配置。")]),t._v(" "),t._m(3),t._v(" "),e("p",[t._v("Envoy 的一些统计数据列在这个 "),e("a",{attrs:{href:"https://www.envoyproxy.io/docs/envoy/latest/configuration/statistics",target:"_blank",rel:"noopener noreferrer"}},[t._v("列表"),e("OutboundLink")],1),t._v(" 中，有一个示例数据包含了 identifier ，可以在 "),e("a",{attrs:{href:"identify.json"}},[t._v("此处")]),t._v(" 找到，只包含指标的示例数据可以在 "),e("a",{attrs:{href:"metrics.json"}},[t._v("此处")]),t._v(" 找到.")])])}),[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"配置-envoy-来向-skywalking-发送度量指标"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置-envoy-来向-skywalking-发送度量指标"}},[this._v("#")]),this._v(" 配置 Envoy 来向 SkyWalking 发送度量指标")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("stats_sinks")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" envoy.metrics_service\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("config")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("grpc_service")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Note: we can use google_grpc implementation as well.")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("envoy_grpc")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cluster_name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" service_skywalking\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("static_resources")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("clusters")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" service_skywalking\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("connect_timeout")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 5s\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" LOGICAL_DNS\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("http2_protocol_options")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dns_lookup_family")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" V4_ONLY\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("lb_policy")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ROUND_ROBIN\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("load_assignment")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cluster_name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" service_skywalking\n      "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("endpoints")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("lb_endpoints")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("endpoint")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("address")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("socket_address")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("address")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" skywalking\n                "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# This is the port where SkyWalking serving the Envoy Metrics Service gRPC stream.")]),t._v("\n                "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port_value")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("11800")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("更完整的静态配置可以在 "),s("a",{attrs:{href:"config.yaml"}},[this._v("此处")]),this._v(" 查看。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"度量指标数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#度量指标数据"}},[this._v("#")]),this._v(" 度量指标数据")])}],!1,null,null,null);s.default=n.exports}}]);