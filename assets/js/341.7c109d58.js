(window.webpackJsonp=window.webpackJsonp||[]).push([[341],{238:function(t,e,s){"use strict";s.r(e);var a=s(0),n=Object(a.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"content"},[t._m(0),t._v(" "),s("p",[t._v("在大多数生产环境中，后端应用需要支持高吞吐量并且支持高可用来保证服务的稳定，所以你始终需要在生产环境进行集群管理。")]),t._v(" "),s("p",[t._v("SkyWalking 的后台提供了几种集群管理的方案。选择你需要或想要的那个。")]),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),t._m(4),t._v(" "),s("p",[t._v("Zookeeper 需要在 3.4 以上版本。")]),t._v(" "),t._m(5),s("ul",[t._m(6),t._v(" "),s("li",[s("code",[t._v("enableACL")]),t._v(" 启用 "),s("a",{attrs:{href:"https://zookeeper.apache.org/doc/r3.4.1/zookeeperProgrammers.html#sc_ZooKeeperAccessControl",target:"_blank",rel:"noopener noreferrer"}},[t._v("Zookeeper ACL"),s("OutboundLink")],1),t._v(" 来控制访问 zk 节点.")]),t._v(" "),t._m(7),t._v(" "),s("li",[s("code",[t._v("expression")]),t._v(" ACL 的表达式. 表达式的格式是针对于 "),s("a",{attrs:{href:"https://zookeeper.apache.org/doc/r3.4.1/zookeeperProgrammers.html#sc_BuiltinACLSchemes",target:"_blank",rel:"noopener noreferrer"}},[t._v("schema"),s("OutboundLink")],1),t._v(".")]),t._v(" "),t._m(8)]),t._v(" "),s("p",[t._v("提醒:")]),t._v(" "),t._m(9),t._v(" "),s("p",[t._v("在某些情况下，OAP 默认的 gRPC 主机和端口在核心中不适合 OAP 节点之间的内部通信。根据您自己的 LAN 环境，可通过下列参数设置你的 host 和 port。")]),t._v(" "),t._m(10),t._v(" "),t._m(11),t._m(12),t._v(" "),s("p",[t._v("需要后端集群部署在 kubernetes 中，参考 "),s("router-link",{attrs:{to:"./backend-k8s.html"}},[t._v("kubernetes 中部署")]),t._v("。设置 selector 为 "),s("code",[t._v("kubernetes")]),t._v("。")],1),t._v(" "),t._m(13),t._m(14),t._v(" "),t._m(15),t._v(" "),t._m(16),s("p",[t._v("与 Zookeeper 协调器一样，在某些情况下，OAP 默认的 gRPC 主机和端口在核心中不适合 OAP 节点之间的内部通信。根据您自己的 LAN 环境，可通过下列参数设置你的 host 和 port。")]),t._v(" "),t._m(17),t._v(" "),t._m(18),t._v(" "),t._m(19),t._v(" "),t._m(20)])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("h1",{attrs:{id:"集群管理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#集群管理"}},[this._v("#")]),this._v(" 集群管理")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",[s("li",[s("a",{attrs:{href:"#zookeeper-coordinator"}},[t._v("Zookeeper 协调方式")]),t._v("。使用 ZooKeeper 让后端实例彼此之间检测和通信。")]),t._v(" "),s("li",[s("a",{attrs:{href:"#kubernetes"}},[t._v("Kubernetes")]),t._v(". 当后台集群部署在 kubernetes 中，你可以选择使用 k8s 原生的 APIs 来管理集群。")]),t._v(" "),s("li",[s("a",{attrs:{href:"#consul"}},[t._v("Consul")]),t._v(". 使用 Consul 作为集群管理的实现者，来协调的实例。")]),t._v(" "),s("li",[s("a",{attrs:{href:"#etcd"}},[t._v("Etcd")]),t._v(". 使用 Etcd 作为集群管理的实现者, 来协调后端的实例。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("在 "),e("code",[this._v("application.yml")]),this._v(" 中, 在 "),e("code",[this._v("cluster")]),this._v(" 部分有上述协调器的默认配置，你可以通过 "),e("code",[this._v("selector")]),this._v(" 属性启用他们中的任意一个。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"zookeeper-coordinator"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#zookeeper-coordinator"}},[this._v("#")]),this._v(" Zookeeper coordinator")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Zookeeper 是一个很常见并的广泛使用的集群协调者。在 yml 文件中设置 "),e("strong",[this._v("cluster/selector")]),this._v(" 为 "),e("strong",[this._v("zookeeper")]),this._v(" 来启用它。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cluster")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("SW_CLUSTER"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("zookeeper"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# other configurations")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("li",[e("code",[this._v("hostPort")]),this._v(" 是 zookeeper 一组服务列表。 格式： "),e("code",[this._v("IP1:PORT1,IP2:PORT2,...,IPn:PORTn")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("li",[e("code",[this._v("schema")]),this._v(" Zookeeper ACL schemas.")])},function(){var t=this.$createElement,e=this._self._c||t;return e("li",[e("code",[this._v("hostPort")]),this._v(", "),e("code",[this._v("baseSleepTimeMs")]),this._v(" 和 "),e("code",[this._v("maxRetries")]),this._v(" 是Zookeeper客户端的设置。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",[s("li",[t._v("如果 "),s("code",[t._v("Zookeeper ACL")]),t._v(" 是启用的并且 "),s("code",[t._v("/skywalking")]),t._v(" 节点存在，必须确保 "),s("code",[t._v("SkyWalking")]),t._v(" 拥有 "),s("code",[t._v("CREATE")]),t._v(", "),s("code",[t._v("READ")]),t._v(" 和 "),s("code",[t._v("WRITE")]),t._v(" 的权限。如果 "),s("code",[t._v("/skywalking")]),t._v(" 节点不存在，将会自动创建并针对指定用户授权所有权限。同时节点也会授权任意用户读权限。")]),t._v(" "),s("li",[t._v("如果设置 "),s("code",[t._v("schema")]),t._v(" 为 "),s("code",[t._v("digest")]),t._v(" ，密码的表达式设置在 "),s("strong",[t._v("明文")]),t._v(" 中。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("internalComHost, 已注册的主机和其它 OAP 节点使用它与当前节点通信。")]),this._v(" "),e("li",[this._v("internalComPort, 已注册的端口和其它 OAP 节点使用它与当前节点通信。")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("zookeeper")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nameSpace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("SW_NAMESPACE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("SW_CLUSTER_ZK_HOST_PORT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2181")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#Retry Policy")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("baseSleepTimeMs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("SW_CLUSTER_ZK_SLEEP_TIME"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# initial amount of time to wait between retries")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("maxRetries")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("SW_CLUSTER_ZK_MAX_RETRIES"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# max number of times to retry")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("internalComHost")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 172.10.4.10\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("internalComPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("11800")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Enable ACL")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enableACL")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("SW_ZK_ENABLE_ACL"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# disable ACL in default")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("schema")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("SW_ZK_SCHEMA"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("digest"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# only support digest schema")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("expression")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("SW_ZK_EXPRESSION"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("skywalking"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("skywalking"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"kubernetes"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes"}},[this._v("#")]),this._v(" Kubernetes")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cluster")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("SW_CLUSTER"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("kubernetes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# other configurations")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"consul"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#consul"}},[this._v("#")]),this._v(" Consul")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("目前，consul 正成为一个著名的系统，很多公司和开发者使用它作为服务发现的方案。在 yml 文件中设置 "),e("strong",[this._v("cluster/selector")]),this._v(" 为 "),e("strong",[this._v("consul")]),this._v(" 启用它。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cluster")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("SW_CLUSTER"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("consul"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# other configurations")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("internalComHost, 已注册的主机和其它 OAP 节点使用它与当前节点通信。")]),this._v(" "),e("li",[this._v("internalComPort, 已注册的端口和其它 OAP 节点使用它与当前节点通信。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"etcd"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#etcd"}},[this._v("#")]),this._v(" Etcd")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("在 yml 文件中设置 "),e("strong",[this._v("cluster/selector")]),this._v(" 为 "),e("strong",[this._v("etcd")]),this._v(" 启用它。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cluster")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("SW_CLUSTER"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("etcd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# other configurations")]),t._v("\n")])])])}],!1,null,null,null);e.default=n.exports}}]);