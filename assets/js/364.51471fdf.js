(window.webpackJsonp=window.webpackJsonp||[]).push([[364],{183:function(s,t,a){"use strict";a.r(t);var n=a(0),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"content"},[s._m(0),s._v(" "),a("p",[s._v("这是一个通过 "),a("a",{attrs:{href:"https://www.envoyproxy.io/docs/envoy/latest/api-v2/config/metrics/v2/metrics_service.proto",target:"_blank",rel:"noopener noreferrer"}},[s._v("度量服务"),a("OutboundLink")],1),s._v(" 发送 "),a("a",{attrs:{href:"https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/observability/statistics#arch-overview-statistics",target:"_blank",rel:"noopener noreferrer"}},[s._v("Envoy 状态"),a("OutboundLink")],1),s._v(" 至 SkyWalking OAP 服务的例子。")]),s._v(" "),s._m(1),s._v(" "),s._m(2),s._v(" "),s._m(3),s._v(" "),s._m(4)])}),[function(){var s=this.$createElement,t=this._self._c||s;return t("h1",{attrs:{id:"发送-envoy-度量指标至-skywalking-oap-服务样例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#发送-envoy-度量指标至-skywalking-oap-服务样例"}},[this._v("#")]),this._v(" 发送 Envoy 度量指标至 SkyWalking OAP 服务样例")])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"运行样例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#运行样例"}},[this._v("#")]),this._v(" 运行样例")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("样例需要本地安装 "),t("code",[this._v("docker")]),this._v(" 和 "),t("code",[this._v("docker-compose")]),this._v("。它从 Docker Hub 获取镜像。")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("注意,在这个设置中，我们覆盖了 "),t("a",{attrs:{href:"log4j2.xml"}},[t("code",[this._v("log4j2.xml")])]),this._v(" 配置来设置 "),t("code",[this._v("org.apache.skywalking.oap.server.receiver.envoy")]),this._v(" 日志级别为 "),t("code",[this._v("DEBUG")]),this._v("。这使我们能够看到 Envoy 发送到 SkyWalking OAP 服务的消息。")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" up\n$ docker-compose logs -f skywalking\n$ "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Please wait for a moment until SkyWalking is ready and Envoy starts sending the stats. You will see similar messages like the following:")]),s._v("\nskywalking_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("-08-31 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":57:40,672 - org.apache.skywalking.oap.server.receiver.envoy.MetricServiceGRPCHandler -26870 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("grpc-default-executor-0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" DEBUG "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" - Received msg identifier "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\nskywalking_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   node "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\nskywalking_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("     id: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ingress"')]),s._v("\nskywalking_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("     cluster: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"envoy-proxy"')]),s._v("\nskywalking_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("     metadata "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\nskywalking_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("       fields "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\nskywalking_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("         key: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"skywalking"')]),s._v("\nskywalking_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("         value "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\nskywalking_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("           string_value: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"iscool"')]),s._v("\nskywalking_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nskywalking_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nskywalking_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("       fields "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\nskywalking_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("         key: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"envoy"')]),s._v("\nskywalking_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("         value "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\nskywalking_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("           string_value: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"isawesome"')]),s._v("\nskywalking_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nskywalking_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nskywalking_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nskywalking_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("     locality "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\nskywalking_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("       region: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ap-southeast-1"')]),s._v("\nskywalking_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("       zone: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"zone1"')]),s._v("\nskywalking_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("       sub_zone: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"subzone1"')]),s._v("\nskywalking_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nskywalking_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("     build_version: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"e349fb6139e4b7a59a9a359be0ea45dd61e589c5/1.11.1/Clean/RELEASE/BoringSSL"')]),s._v("\nskywalking_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nskywalking_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nskywalking_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" envoy_metrics "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\nskywalking_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cluster.service_skywalking.update_success"')]),s._v("\nskywalking_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   type: COUNTER\nskywalking_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   metric "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\nskywalking_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("     counter "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\nskywalking_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("       value: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.0")]),s._v("\nskywalking_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nskywalking_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("     timestamp_ms: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1567295859556")]),s._v("\nskywalking_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nskywalking_1  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n$ "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# To tear down:")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" down\n")])])])}],!1,null,null,null);t.default=e.exports}}]);