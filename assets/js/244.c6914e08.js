(window.webpackJsonp=window.webpackJsonp||[]).push([[244],{529:function(t,s,e){"use strict";e.r(s);var a=e(0),n=Object(a.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),e("p",[t._v("定义范围和实体名称之间的关系.")]),t._v(" "),t._m(4),t._v(" "),t._m(5),t._v(" "),e("p",[t._v("报警规则主要有以下几点：")]),t._v(" "),t._m(6),t._v(" "),t._m(7),t._m(8),t._v(" "),t._m(9),t._v(" "),t._m(10),t._v(" "),e("p",[t._v("这些度量名称定义在 "),e("router-link",{attrs:{to:"./../../guides/backend-oal-scripts.html"}},[t._v("OAL 脚本")]),t._v("中, 现在，来自"),e("strong",[t._v("Service")]),t._v(", "),e("strong",[t._v("Service Instance")]),t._v(", "),e("strong",[t._v("Endpoint")]),t._v("的度量可以用于告警，我们会在后期版本中进行扩展。")],1),t._v(" "),e("p",[t._v("如果你希望有其它的告警场景，请提交issue或pr。")]),t._v(" "),t._m(11),t._v(" "),t._m(12),t._v(" "),t._m(13),t._v(" "),e("p",[t._v("以下是一个样例")]),t._v(" "),t._m(14),t._m(15),t._v(" "),t._m(16),t._v(" "),e("p",[t._v("协议的部分内容如下:")]),t._v(" "),t._m(17),t._m(18),t._v(" "),e("p",[t._v("从6.5.0开始，可以通过"),e("router-link",{attrs:{to:"./dynamic-config.html"}},[t._v("动态配置")]),t._v("在运行时动态更新报警设置 ,\n它将覆盖 "),e("code",[t._v("alarm-settings.yml")]),t._v(" 中的设置.")],1),t._v(" "),t._m(19)])}),[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"告警"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#告警"}},[this._v("#")]),this._v(" 告警")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("告警的核心由一组规则驱动，这些规则定义在"),s("code",[this._v("config/ Alarm -settings.yml")]),this._v("文件中。\n告警规则的定义分为三部分。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",[s("li",[this._v("告警规则。它们定义了应该如何触发度量警报，应该考虑什么条件。")]),this._v(" "),s("li",[this._v("[网络钩子](#Webhook}。当警告触发时，哪些服务终端需要被告知。")]),this._v(" "),s("li",[s("a",{attrs:{href:"#gRPCHook"}},[this._v("gRPC钩子")]),this._v(". 远程gRPC方法的主机和端口，告警触发后调用.")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"实体名称"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实体名称"}},[this._v("#")]),this._v(" 实体名称")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ul",[e("li",[e("strong",[t._v("服务")]),t._v(": 服务名称")]),t._v(" "),e("li",[e("strong",[t._v("实例")]),t._v(": {服务名称} 的 {实例名称}")]),t._v(" "),e("li",[e("strong",[t._v("端点")]),t._v(": {服务名称} 中的 {端点名称} in {Service name}")]),t._v(" "),e("li",[e("strong",[t._v("Database")]),t._v(": Database service name")]),t._v(" "),e("li",[e("strong",[t._v("Service Relation")]),t._v(": {Source service name} to {Dest service name}")]),t._v(" "),e("li",[e("strong",[t._v("Instance Relation")]),t._v(": {Source instance name} of {Source service name} to {Dest instance name} of {Dest service name}")]),t._v(" "),e("li",[e("strong",[t._v("Endpoint Relation")]),t._v(": {Source endpoint name} in {Source Service name} to {Dest endpoint name} in {Dest service name}")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"规则"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#规则"}},[this._v("#")]),this._v(" 规则")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ul",[e("li",[e("strong",[t._v("Rule name")]),t._v("。在告警信息中显示的唯一名称。必须以"),e("code",[t._v("_rule")]),t._v("结尾。")]),t._v(" "),e("li",[e("strong",[t._v("Metrics name")]),t._v("。 也是oal脚本中的度量名。只支持long,double和int类型。详情见 "),e("a",{attrs:{href:"#%E6%89%80%E6%9C%89%E5%8F%AF%E8%83%BD%E7%9A%84%E5%BA%A6%E9%87%8F%E5%90%8D%E7%A7%B0%E5%88%97%E8%A1%A8"}},[t._v("所有可能的度量名称列表")]),t._v(".")]),t._v(" "),e("li",[e("strong",[t._v("Include names")]),t._v("。其下的实体名称都在此规则中. 请遵循"),e("a",{attrs:{href:"#%E5%AE%9E%E4%BD%93%E5%90%8D%E7%A7%B0"}},[t._v("实体名称定义")]),t._v("。")]),t._v(" "),e("li",[e("strong",[t._v("Exclude names")]),t._v(". 以下实体名称不在此规则中. 请遵循"),e("a",{attrs:{href:"#%E5%AE%9E%E4%BD%93%E5%90%8D%E7%A7%B0"}},[t._v("实体名称定义")]),t._v(".")]),t._v(" "),e("li",[e("strong",[t._v("Include names regex")]),t._v(".提供一个正则表达式来包含实体名称. 如果同时设置包含名称的列表和包含名称的正则表达式，则两个规则都将生效.")]),t._v(" "),e("li",[e("strong",[t._v("Exclude names regex")]),t._v(". 提供一个正则表达式来排除需要排除的名称. 如果同时设置排除的名称列表和排除名称的正则表达式，则两个规则都将生效.")]),t._v(" "),e("li",[e("strong",[t._v("Threshold")]),t._v("。阈值。\n对于多个值指标，例如"),e("strong",[t._v("percentile")]),t._v("，阈值是一个数组。像"),e("code",[t._v("value1")]),t._v(" "),e("code",[t._v("value2")]),t._v(" "),e("code",[t._v("value3")]),t._v(" "),e("code",[t._v("value4")]),t._v(" "),e("code",[t._v("value5")]),t._v("这样描述.\n每个值可以作为度量中每个值的阈值。如果不想通过此值或某些值触发警报，则将值设置为 "),e("code",[t._v("-")]),t._v("."),e("br"),t._v("\n例如在"),e("strong",[t._v("percentile")]),t._v("中，"),e("code",[t._v("value1")]),t._v("是P50的阈值,且 "),e("code",[t._v("-，-，value3, value4, value5")]),t._v("的意思是，没有阈值的P50和P75百分位告警规则.")]),t._v(" "),e("li",[e("strong",[t._v("OP")]),t._v("。 操作符, 支持 "),e("code",[t._v(">")]),t._v(", "),e("code",[t._v("<")]),t._v(", "),e("code",[t._v("=")]),t._v("。欢迎贡献所有的操作符。")]),t._v(" "),e("li",[e("strong",[t._v("Period")]),t._v(".。多久告警规则需要被核实一下。这是一个时间窗口，与后端部署环境时间相匹配。")]),t._v(" "),e("li",[e("strong",[t._v("Count")]),t._v("。 在一个Period窗口中，如果"),e("strong",[t._v("value")]),t._v("s超过Threshold值（按op），达到Count值，需要发送警报。")]),t._v(" "),e("li",[e("strong",[t._v("Silence period")]),t._v("。在时间N中触发报警后，在"),e("strong",[t._v("TN -> TN + period")]),t._v("这个阶段不告警。 默认情况下，它和"),e("strong",[t._v("Period")]),t._v("一样，这意味着相同的告警（在同一个Metrics name拥有相同的Id）在同一个Period内只会触发一次。")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("rules")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 规则唯一名称，必须以'_rule'结尾.")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("endpoint_percent_rule")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 度量值为 long、double或int 类型")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metrics-name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" endpoint_percent\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("threshold")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("75")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("op")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 评估度量标准的时间长度")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("period")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 度量有多少次符合告警条件后，才会触发告警")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("count")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#检查多少次，告警触发后保持沉默，默认周期相同")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("silence-period")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n    \n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("service_percent_rule")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metrics-name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" service_percent\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# [可选]默认，匹配此指标中的所有服务")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("include-names")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" service_a\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" service_b\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("exclude-names")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" service_c\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("threshold")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("85")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("op")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" <\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("period")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("count")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("service_resp_time_percentile_rule")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 度量值为 long、double或int 类型")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metrics-name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" service_percentile\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("op")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('">"')]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 多种指标值的阈值。P50、P75、P90、P95、P99的阈值")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("threshold")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("period")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("count")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("silence-period")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("message")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Percentile response time of service "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("name"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" alarm in 3 minutes of last 10 minutes"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" due to more than one condition of p50 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v(" 1000"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" p75 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v(" 1000"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" p90 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v(" 1000"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" p95 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v(" 1000"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" p99 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v(" 1000\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"默认告警规则"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#默认告警规则"}},[this._v("#")]),this._v(" 默认告警规则")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("为了方便，我们在发行版中提供了默认的"),s("code",[this._v("alarm setting.yml")]),this._v("文件，包括以下规则\n1.最近 3 分钟内服务平均响应时间超过 1 秒。\n1.服务成功率在最近 2 分钟内低于80%。\n1.服务响应时间在最近 3 分钟内低于 1000 毫秒.\n1.服务实例在最近 2 分钟内的平均响应时间超过 1 秒。\n1.端点平均响应时间在最近 2 分钟内超过1秒。\n1.数据库访问平均响应时间在过去 2 分钟内超过 1 秒。\n1.端点之间平均响应时间在最近 2 分钟内超过 1 秒。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"所有可能的度量名称列表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#所有可能的度量名称列表"}},[this._v("#")]),this._v(" 所有可能的度量名称列表")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"webhook"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#webhook"}},[this._v("#")]),this._v(" Webhook")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("p",[t._v("SkyWalking 的告警 Webhook 要求对等方是一个 Web 容器. 告警的消息会通过 HTTP 请求进行发送, 请求方法为 "),e("code",[t._v("POST")]),t._v(", "),e("code",[t._v("Content-Type")]),t._v(" 为 "),e("code",[t._v("application/json")]),t._v(",\nJSON 格式基于 "),e("code",[t._v("List<org.apache.skywalking.oap.server.core.alarm.AlarmMessage")]),t._v(", 包含以下信息.")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ul",[e("li",[e("strong",[t._v("scopeId")]),t._v(". 所有可用的 Scope 请查阅 "),e("code",[t._v("org.apache.skywalking.oap.server.core.source.DefaultScopeDefine")]),t._v(".")]),t._v(" "),e("li",[e("strong",[t._v("name")]),t._v(". 目标 Scope 的实体名称.")]),t._v(" "),e("li",[e("strong",[t._v("id0")]),t._v(". Scope 实体的 ID.")]),t._v(" "),e("li",[e("strong",[t._v("id1")]),t._v(". 未使用.")]),t._v(" "),e("li",[e("strong",[t._v("ruleName")]),t._v(". 您在 "),e("code",[t._v("alarm-settings.yml")]),t._v(" 中配置的规则名.")]),t._v(" "),e("li",[e("strong",[t._v("alarmMessage")]),t._v(". 报警消息内容.")]),t._v(" "),e("li",[e("strong",[t._v("startTime")]),t._v(". 告警时间, 位于当前时间与 UTC 1970/1/1 之间.")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-json extra-class"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"scopeId"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n        "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"name"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"serviceA"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n\t"),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"id0"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  \n\t"),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"id1"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  \n    "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"ruleName"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"service_resp_time_rule"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"alarmMessage"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"alarmMessage xxxx"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"startTime"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1560524171000")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"scopeId"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"name"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"serviceB"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"id0"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"id1"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"ruleName"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"service_resp_time_rule"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"alarmMessage"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"alarmMessage yyy"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),e("span",{pre:!0,attrs:{class:"token property"}},[t._v('"startTime"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1560524171000")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"grpchook"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#grpchook"}},[this._v("#")]),this._v(" gRPCHook")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("告警消息将使用 "),s("code",[this._v("Protobuf")]),this._v(" 类型通过gRPC远程方法发送.\n消息格式，以下文件定义了关键信息 "),s("code",[this._v("oap-server/server-alarm-plugin/src/main/proto/alarm-hook.proto")]),this._v(".")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-protobuf extra-class"},[e("pre",{pre:!0,attrs:{class:"language-protobuf"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("message")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AlarmMessage")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int64")]),t._v(" scopeId "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" scope "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" name "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" id0 "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" id1 "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" ruleName "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" alarmMessage "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int64")]),t._v(" startTime "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"动态更新配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#动态更新配置"}},[this._v("#")]),this._v(" 动态更新配置")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("p",[t._v("为了确定是否触发告警规则, SkyWalking 需要为每个告警规则缓存时间窗的指标, 如果任何属性 ("),e("code",[t._v("metrics-name")]),t._v(", "),e("code",[t._v("op")]),t._v(", "),e("code",[t._v("threshold")]),t._v(", "),e("code",[t._v("period")]),t._v(", "),e("code",[t._v("count")]),t._v(", etc.) 的规则改变,\n滑动窗口将会毁坏和重建, 导致此告警规则重新启动.")])}],!1,null,null,null);s.default=n.exports}}]);