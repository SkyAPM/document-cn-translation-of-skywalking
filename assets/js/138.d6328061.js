(window.webpackJsonp=window.webpackJsonp||[]).push([[138],{406:function(t,a,s){"use strict";s.r(a);var n=s(0),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"content"},[t._m(0),t._v(" "),s("p",[t._v("本文档描述了如何理解, 开发和贡献插件.")]),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),s("p",[t._v("Span 是分布式追踪系统中一个重要且常用的概念. 可从 "),s("a",{attrs:{href:"https://research.google.com/pubs/pub36356.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Google Dapper Paper"),s("OutboundLink")],1),t._v(" 和 "),s("a",{attrs:{href:"http://opentracing.io",target:"_blank",rel:"noopener noreferrer"}},[t._v("OpenTracing"),s("OutboundLink")],1),t._v(" 学习更多与 "),s("strong",[t._v("Span")]),t._v(" 相关的知识.")]),t._v(" "),s("p",[t._v("SkyWalking 从 2017 年开始支持 OpenTracing 和 OpenTracing-Java API, 我们的 Span 在概念上与谷歌论文和 OpenTracing 里描述的类似. 我们也扩展了 Span.")]),t._v(" "),s("p",[t._v("Span 有三种类型")]),t._v(" "),s("p",[t._v("1.1 EntrySpan")]),t._v(" "),s("p",[t._v("EntrySpan 代表服务提供者, 也是服务器端的端点. 作为一个 APM 系统, 我们的目标是应用服务器. 所以几乎所有的服务和 MQ-消费者 都是 EntrySpan.")]),t._v(" "),s("p",[t._v("1.2 LocalSpan")]),t._v(" "),s("p",[t._v("LocalSpan 表示普通的 Java 方法, 它与远程服务无关, 不是 MQ 生产者/消费者, 也不是服务（例如 HTTP 服务）提供者/消费者.")]),t._v(" "),s("p",[t._v("1.3 ExitSpan")]),t._v(" "),t._m(3),t._v(" "),t._m(4),t._v(" "),s("p",[t._v("为了实现分布式追踪, 需要绑定跨进程的追踪, 并且上下文应该在整个过程中随之传播. 这就是 ContextCarrier 的职责.")]),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),s("p",[t._v("让我们通过 Apache HttpComponent client 插件和 Tomcat 7 服务器插件演示, 步骤如下:")]),t._v(" "),t._m(7),t._v(" "),t._m(8),t._m(9),t._v(" "),t._m(10),t._m(11),t._v(" "),s("p",[t._v("除了跨进程, 跨线程也是需要支持的, 例如异步线程（内存中的消息队列）和批处理在 Java 中很常见. 跨进程和跨线程十分相似, 因为都是需要传播上下文. 唯一的区别是, 跨线程不需要序列化.")]),t._v(" "),s("p",[t._v("以下是有关跨线程传播的三个步骤：")]),t._v(" "),t._m(12),t._v(" "),t._m(13),t._v(" "),t._m(14),t._v(" "),s("p",[t._v("ContextManager 提供所有主要 API.")]),t._v(" "),t._m(15),t._v(" "),t._m(16),t._m(17),t._v(" "),t._m(18),t._v(" "),t._m(19),s("p",[t._v("根据操作名称(例如完整的方法签名)创建 LocalSpan.")]),t._v(" "),t._m(20),t._v(" "),t._m(21),t._m(22),t._v(" "),t._m(23),t._v(" "),t._m(24),s("p",[t._v("除了设置操作名称, 标签信息和日志外, 还要设置两个属性, 即 component（组件）和 layer（层）, 特别是对于 EntrySpan 和 ExitSpan.")]),t._v(" "),s("p",[t._v("SpanLayer 是 span 的类别. 有五个值:")]),t._v(" "),t._m(25),t._v(" "),s("p",[t._v("组件 ID 由 SkyWalking 项目定义和保留, 对于组件的名称或 ID 的扩展, 请遵循"),s("router-link",{attrs:{to:"./Component-library-settings.html"}},[t._v("组件库的定义与扩展")]),t._v(".")],1),t._v(" "),t._m(26),t._v(" "),t._m(27),t._v(" "),s("p",[t._v("关于 Span 有一系列高级 API, 他们都是在异步场景下使用的. 当 Span 的 tag, 日志和属性(包括结束时间)需要在另一个线程中设置时, 你就应该使用这些 API.")]),t._v(" "),t._m(28),t._m(29),t._v(" "),t._m(30),t._v(" "),t._m(31),t._v(" "),s("p",[t._v("追踪的基本方法是拦截 Java 方法, 使用字节码操作技术和 AOP 概念. SkyWalking 包装了字节码操作技术, 并追踪上下文的传播. 所以你只需要定义拦截点(换句话说就是 Spring 的切面).")]),t._v(" "),t._m(32),t._v(" "),s("p",[t._v("SkyWalking 提供两类通用的定义去拦截构造方法, 实例方法和类方法.")]),t._v(" "),t._m(33),t._v(" "),t._m(34),t._v(" "),t._m(35),t._v(" "),t._m(36),t._v(" "),t._m(37),t._v(" "),t._m(38),s("p",[t._v("ClassMatch 表示如何去匹配目标类, 这里有四种方法:")]),t._v(" "),t._m(39),t._v(" "),t._m(40),t._v(" "),t._m(41),t._v(" "),s("p",[t._v("实例：")]),t._v(" "),t._m(42),t._m(43),t._v(" "),t._m(44),t._m(45),t._v(" "),s("p",[t._v("以下部分将告诉您如何实现拦截器.")]),t._v(" "),t._m(46),t._v(" "),t._m(47),t._m(48),t._v(" "),t._m(49),t._v(" "),t._m(50),s("p",[t._v("在方法调用前, 调用后以及异常处理阶段使用核心 API.")]),t._v(" "),t._m(51),t._v(" "),s("p",[t._v("我们欢迎大家贡献插件.")]),t._v(" "),s("p",[t._v("请按照以下步骤操作：")]),t._v(" "),t._m(52)])}),[function(){var t=this.$createElement,a=this._self._c||t;return a("h1",{attrs:{id:"插件开发指南"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#插件开发指南"}},[this._v("#")]),this._v(" 插件开发指南")])},function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{attrs:{id:"概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#概念"}},[this._v("#")]),this._v(" 概念")])},function(){var t=this.$createElement,a=this._self._c||t;return a("h3",{attrs:{id:"span"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#span"}},[this._v("#")]),this._v(" Span")])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("ExitSpan 代表一个服务客户端或 MQ 的生产者, 在 SkyWalking 的早期命名为 "),a("code",[this._v("LeafSpan")]),this._v(". 例如 通过 JDBC 访问 DB, 读取 Redis/Memcached 被归类为 ExitSpan.")])},function(){var t=this.$createElement,a=this._self._c||t;return a("h3",{attrs:{id:"上下文载体-contextcarrier"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#上下文载体-contextcarrier"}},[this._v("#")]),this._v(" 上下文载体 (ContextCarrier)")])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("以下是有关如何在 "),a("code",[this._v("A -> B")]),this._v(" 分布式调用中使用 "),a("strong",[this._v("ContextCarrier")]),this._v(" 的步骤.")])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ol",[s("li",[t._v("在客户端, 创建一个新的空的 "),s("code",[t._v("ContextCarrier")]),t._v(".")]),t._v(" "),s("li",[t._v("通过 "),s("code",[t._v("ContextManager#createExitSpan")]),t._v(" 创建一个 ExitSpan 或者使用 "),s("code",[t._v("ContextManager#inject")]),t._v(" 来初始化 "),s("code",[t._v("ContextCarrier")]),t._v(".")]),t._v(" "),s("li",[t._v("将 "),s("code",[t._v("ContextCarrier")]),t._v(" 所有信息放到请求头 (如 HTTP HEAD), 附件(如 Dubbo RPC 框架), 或者消息 (如 Kafka) 中")]),t._v(" "),s("li",[t._v("通过服务调用, 将 "),s("code",[t._v("ContextCarrier")]),t._v(" 传递到服务端.")]),t._v(" "),s("li",[t._v("在服务端, 在对应组件的头部, 附件或消息中获取 "),s("code",[t._v("ContextCarrier")]),t._v(" 所有内容.")]),t._v(" "),s("li",[t._v("通过 "),s("code",[t._v("ContestManager#createEntrySpan")]),t._v(" 创建 EntrySpan 或者使用 "),s("code",[t._v("ContextManager#extract")]),t._v(" 来绑定服务端和客户端.")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("ol",[a("li",[this._v("客户端 Apache HttpComponent client 插件")])])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[t._v("span "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ContextManager")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createExitSpan")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/span/operation/name"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" contextCarrier"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ip:port"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CarrierItem")]),t._v(" next "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" contextCarrier"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("items")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("next"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("hasNext")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    next "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" next"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    httpRequest"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("next"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHeadKey")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHeadValue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,a=this._self._c||t;return a("ol",{attrs:{start:"2"}},[a("li",[this._v("服务端 Tomcat 7 服务器插件")])])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ContextCarrier")]),t._v(" contextCarrier "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ContextCarrier")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CarrierItem")]),t._v(" next "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" contextCarrier"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("items")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("next"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("hasNext")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    next "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" next"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    next"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeadValue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHeader")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("next"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHeadKey")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nspan "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ContextManager")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createEntrySpan")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/span/operation/name"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" contextCarrier"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h3",{attrs:{id:"上下文快照-contextsnapshot"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#上下文快照-contextsnapshot"}},[this._v("#")]),this._v(" 上下文快照 (ContextSnapshot)")])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ol",[s("li",[t._v("使用 "),s("code",[t._v("ContextManager#capture")]),t._v(" 方法获取 ContextSnapshot 对象.")]),t._v(" "),s("li",[t._v("让子线程以任何方式, 通过方法参数或由现有参数携带来访问 ContextSnapshot")]),t._v(" "),s("li",[t._v("在子线程中使用 "),s("code",[t._v("ContextManager#continued")]),t._v(".")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{attrs:{id:"核心-api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#核心-api"}},[this._v("#")]),this._v(" 核心 API")])},function(){var t=this.$createElement,a=this._self._c||t;return a("h3",{attrs:{id:"上下文管理器-contextmanager"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#上下文管理器-contextmanager"}},[this._v("#")]),this._v(" 上下文管理器 (ContextManager)")])},function(){var t=this.$createElement,a=this._self._c||t;return a("ol",[a("li",[this._v("创建 EntrySpan")])])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AbstractSpan")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createEntrySpan")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" endpointName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ContextCarrier")]),t._v(" carrier"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("根据操作名称(例如服务名称, uri) 和 "),a("strong",[this._v("上下文载体 (ContextCarrier)")]),this._v(" 创建 EntrySpan.")])},function(){var t=this.$createElement,a=this._self._c||t;return a("ol",{attrs:{start:"2"}},[a("li",[this._v("创建 LocalSpan")])])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AbstractSpan")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createLocalSpan")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" endpointName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])},function(){var t=this.$createElement,a=this._self._c||t;return a("ol",{attrs:{start:"3"}},[a("li",[this._v("创建 ExitSpan")])])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AbstractSpan")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createExitSpan")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" endpointName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ContextCarrier")]),t._v(" carrier"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" remotePeer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("根据操作名称(例如服务名称, uri), "),a("strong",[this._v("上下文载体 (ContextCarrier)")]),this._v(" 以及对等端 (peer) 地址(例如 ip + port 或 hostname + port) 创建 ExitSpan.")])},function(){var t=this.$createElement,a=this._self._c||t;return a("h3",{attrs:{id:"abstractspan"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#abstractspan"}},[this._v("#")]),this._v(" AbstractSpan")])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * Set the component id, which defines in {@link ComponentsDefine}\n *\n * @param component\n * @return the span for chaining.\n */")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AbstractSpan")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setComponent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Component")]),t._v(" component"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * Only use this method in explicit instrumentation, like opentracing-skywalking-bridge.\n * It it higher recommend don't use this for performance consideration.\n *\n * @param componentName\n * @return the span for chaining.\n */")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AbstractSpan")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setComponent")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" componentName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AbstractSpan")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setLayer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SpanLayer")]),t._v(" layer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * Set a key:value tag on the Span.\n *\n * @return this Span instance, for chaining\n */")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AbstractSpan")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("tag")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * Record an exception event of the current walltime timestamp.\n *\n * @param t any subclass of {@link Throwable}, which occurs in this span.\n * @return the Span, for chaining\n */")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AbstractSpan")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Throwable")]),t._v(" t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AbstractSpan")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("errorOccurred")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * Record an event at a specific timestamp.\n *\n * @param timestamp The explicit timestamp for the log record.\n * @param event the events\n * @return the Span, for chaining\n */")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AbstractSpan")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" timestamp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Map")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" event"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * Sets the string name for the logical operation this span represents.\n *\n * @return this Span instance, for chaining\n */")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AbstractSpan")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setOperationName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" endpointName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ol",[s("li",[t._v("UNKNOWN (默认值)")]),t._v(" "),s("li",[t._v("DB")]),t._v(" "),s("li",[t._v("RPC_FRAMEWORK,（针对 RPC 框架, 非普通的 HTTP 调用）")]),t._v(" "),s("li",[t._v("HTTP")]),t._v(" "),s("li",[t._v("MQ")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h3",{attrs:{id:"高级-api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#高级-api"}},[this._v("#")]),this._v(" 高级 API")])},function(){var t=this.$createElement,a=this._self._c||t;return a("h4",{attrs:{id:"异步-span-api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#异步-span-api"}},[this._v("#")]),this._v(" 异步 Span API")])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * The span finish at current tracing context, but the current span is still alive, until {@link #asyncFinish}\n * called.\n *\n * This method must be called<br/>\n * 1. In original thread(tracing context).\n * 2. Current span is active span.\n *\n * During alive, tags, logs and attributes of the span could be changed, in any thread.\n *\n * The execution times of {@link #prepareForAsync} and {@link #asyncFinish()} must match.\n *\n * @return the current span\n */")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AbstractSpan")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("prepareForAsync")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * Notify the span, it could be finished.\n *\n * The execution times of {@link #prepareForAsync} and {@link #asyncFinish()} must match.\n *\n * @return the current span\n */")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AbstractSpan")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("asyncFinish")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ol",[s("li",[t._v("在原始上下文中调用 "),s("code",[t._v("#prepareForAsync")]),t._v(".")]),t._v(" "),s("li",[t._v("将该 Span  传播到其他线程.")]),t._v(" "),s("li",[t._v("在全部操作就绪之后, 可在任意线程中调用 "),s("code",[t._v("#asyncFinish")]),t._v(" 结束调用.")]),t._v(" "),s("li",[t._v("当所有 Span 的 "),s("code",[t._v("#prepareForAsync")]),t._v(" 完成后, 追踪上下文会结束, 并一起被回传到后端服务(根据 API 执行次数判断).")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{attrs:{id:"开发插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开发插件"}},[this._v("#")]),this._v(" 开发插件")])},function(){var t=this.$createElement,a=this._self._c||t;return a("h3",{attrs:{id:"摘要"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#摘要"}},[this._v("#")]),this._v(" 摘要")])},function(){var t=this.$createElement,a=this._self._c||t;return a("h3",{attrs:{id:"拦截"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#拦截"}},[this._v("#")]),this._v(" 拦截")])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ul",[s("li",[s("code",[t._v("ClassInstanceMethodsEnhancePluginDefine")]),t._v(" 定义了构造方法 "),s("code",[t._v("Contructor")]),t._v(" 拦截点和 "),s("code",[t._v("instance method")]),t._v(" 实例方法拦截点.")]),t._v(" "),s("li",[s("code",[t._v("ClassStaticMethodsEnhancePluginDefine")]),t._v(" 定义了类方法 "),s("code",[t._v("class method")]),t._v(" 拦截点.")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("当然, 您也可以继承 "),a("code",[this._v("ClassEnhancePluginDefine")]),this._v(" 去设置所有的拦截点, 但这不常用.")])},function(){var t=this.$createElement,a=this._self._c||t;return a("h3",{attrs:{id:"实现插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实现插件"}},[this._v("#")]),this._v(" 实现插件")])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("下文, 我将通过扩展 "),a("code",[this._v("ClassInstanceMethodsEnhancePluginDefine")]),this._v(" 来演示如何实现一个插件")])},function(){var t=this.$createElement,a=this._self._c||t;return a("ol",[a("li",[this._v("定义目标类的名称")])])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("protected")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("abstract")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ClassMatch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("enhanceClass")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ul",[s("li",[t._v("byName, 通过类的全限定名(Fully Qualified Class Name, 即 包名 + "),s("code",[t._v(".")]),t._v(" + 类名).")]),t._v(" "),s("li",[t._v("byClassAnnotationMatch, 根据目标类是否存在某些注解.")]),t._v(" "),s("li",[t._v("byMethodAnnotationMatch, 根据目标类的方法是否存在某些注解.")]),t._v(" "),s("li",[t._v("byHierarchyMatch, 根据目标类的父类或接口")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[a("strong",[this._v("注意事项")]),this._v(":")])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ul",[s("li",[t._v("禁止使用 "),s("code",[t._v("*.class.getName()")]),t._v(" 去获取类名, 建议你使用文本字符串, 这是为了避免 ClassLoader 的问题.")]),t._v(" "),s("li",[s("code",[t._v("by*AnnotationMatch")]),t._v(" 不支持从父类继承来的注解.")]),t._v(" "),s("li",[t._v("除非确实必要, 否则不建议使用 "),s("code",[t._v("byHierarchyMatch")]),t._v(", 因为使用它可能会触发拦截许多预期之外的方法, 会导致性能问题和不稳定.")])])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("protected")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ClassMatch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("enhanceClassName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("byName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"org.apache.catalina.core.StandardEngineValve"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])])},function(){var t=this.$createElement,a=this._self._c||t;return a("ol",{attrs:{start:"2"}},[a("li",[this._v("定义实例方法拦截点")])])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("protected")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InstanceMethodsInterceptPoint")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getInstanceMethodsInterceptPoints")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InstanceMethodsInterceptPoint")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * class instance methods matcher.\n     *\n     * @return methods matcher\n     */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ElementMatcher")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MethodDescription")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getMethodsMatcher")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * @return represents a class name, the class instance must instanceof InstanceMethodsAroundInterceptor.\n     */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getMethodsInterceptor")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("isOverrideArgs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("也可以使用 "),a("code",[this._v("Matcher")]),this._v(" 来设置目标方法. 如果要在拦截器中更改引用参数, 请在 "),a("code",[this._v("isOverrideArgs")]),this._v(" 中返回 "),a("strong",[this._v("true")]),this._v(".")])},function(){var t=this.$createElement,a=this._self._c||t;return a("ol",{attrs:{start:"3"}},[a("li",[this._v("在文件 "),a("code",[this._v("skywalking-plugin.def")]),this._v(" 中添加插件定义")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"language-properties extra-class"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token attr-name"}},[this._v("tomcat-7.x/8.x")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[this._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[this._v("TomcatInstrumentation")]),this._v("\n")])])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h3",{attrs:{id:"实现一个拦截器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实现一个拦截器"}},[this._v("#")]),this._v(" 实现一个拦截器")])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("作为一个实例方法的拦截器, 需要实现 "),a("code",[this._v("org.apache.skywalking.apm.agent.core.plugin.interceptor.enhance.InstanceMethodsAroundInterceptor")])])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * A interceptor, which intercept method's invocation. The target methods will be defined in {@link\n * ClassEnhancePluginDefine}'s subclass, most likely in {@link ClassInstanceMethodsEnhancePluginDefine}\n *\n * @author wusheng\n */")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InstanceMethodsAroundInterceptor")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * called before target method invocation.\n     *\n     * @param result change this result, if you want to truncate the method.\n     * @throws Throwable\n     */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("beforeMethod")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EnhancedInstance")]),t._v(" objInst"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Method")]),t._v(" method"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" allArguments"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Class")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" argumentsTypes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MethodInterceptResult")]),t._v(" result"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Throwable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * called after target method invocation. Even method's invocation triggers an exception.\n     *\n     * @param ret the method's original return value.\n     * @return the method's actual return value.\n     * @throws Throwable\n     */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("afterMethod")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EnhancedInstance")]),t._v(" objInst"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Method")]),t._v(" method"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" allArguments"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Class")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" argumentsTypes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),t._v(" ret"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Throwable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * called when occur exception.\n     *\n     * @param t the exception occur.\n     */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("handleMethodException")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("EnhancedInstance")]),t._v(" objInst"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Method")]),t._v(" method"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" allArguments"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Class")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" argumentsTypes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Throwable")]),t._v(" t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h3",{attrs:{id:"将插件贡献到-apache-skywalking-仓库中"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#将插件贡献到-apache-skywalking-仓库中"}},[this._v("#")]),this._v(" 将插件贡献到 Apache SkyWalking 仓库中")])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ol",[s("li",[t._v("提交有关您要贡献哪些插件的问题, 包括支持的版本.")]),t._v(" "),s("li",[t._v("在 "),s("code",[t._v("apm-sniffer/apm-sdk-plugin")]),t._v(" 或 "),s("code",[t._v("apm-sniffer/optional-plugins")]),t._v(" 下创建子模块, 名称应包含支持的库名和版本")]),t._v(" "),s("li",[t._v("按照本指南进行开发. 确保提供注释和测试用例.")]),t._v(" "),s("li",[t._v("开发并测试.")]),t._v(" "),s("li",[t._v("发送 Pull Request 并要求审核.")]),t._v(" "),s("li",[t._v("提供自动测试用例.")]),t._v(" "),s("li",[t._v("在提供自动测试用例并在 CI 通过测试后, 插件审批人员会批准您的插件.")]),t._v(" "),s("li",[t._v("SkyWalking 接受新的插件.")])])}],!1,null,null,null);a.default=e.exports}}]);